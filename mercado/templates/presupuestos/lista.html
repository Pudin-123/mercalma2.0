{% extends "base.html" %}
{% block title %}Listado de Presupuestos{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="fw-bold mb-4 text-center">ğŸ“‹ Listado de Presupuestos</h2>

  <!-- ğŸŸ¢ Estado del Bot de Telegram -->
  {% if ultimo_log %}
  <div class="alert alert-success shadow-sm d-flex align-items-center justify-content-between">
    <div>
      âœ… <strong>El servidor recibiÃ³ mensajes desde Telegram.</strong>
    </div>
    <span class="badge bg-success">Conectado</span>
  </div>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body bg-light">
      <h5 class="card-title mb-3">ğŸ“© Ãšltimo mensaje recibido</h5>
      <ul class="list-unstyled mb-0">
        <li><strong>ğŸ‘¤ Usuario:</strong> {{ ultimo_log.username }} <span class="text-muted">(ID: {{ ultimo_log.chat_id }})</span></li>
        <li><strong>ğŸ’¬ Mensaje:</strong> {{ ultimo_log.mensaje }}</li>
        <li><strong>â° Recibido:</strong> {{ ultimo_log.recibido_en|date:"d/m/Y H:i" }}</li>
      </ul>
    </div>
  </div>
  {% else %}
  <div class="alert alert-warning shadow-sm">
    âš ï¸ AÃºn no llegaron mensajes desde Telegram.
  </div>
  {% endif %}

  <!-- ğŸ“¦ Lista de presupuestos -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white fw-semibold">
      ğŸ“¦ Presupuestos registrados
    </div>
    <div class="card-body p-0">
      {% if presupuestos %}
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">Producto</th>
            <th scope="col">Email</th>
          </tr>
        </thead>
        <tbody>
          {% for p in presupuestos %}
          <tr>
            <td>{{ p.producto }}</td>
            <td>{{ p.email }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="p-4 text-center text-muted">
        ğŸ“­ No hay presupuestos registrados aÃºn.
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
